<div class="modal fade" id="patient_records_modal" tabindex="-1" aria-labelledby="patientRecordsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content border-0 shadow-lg">
            <!-- Modal Header -->
            <div class="modal-header bg-gradient-primary text-white border-0">
                <div class="d-flex align-items-center">
                    <div class="modal-icon me-3">
                        <i class="fa-solid fa-file-medical"></i>
                    </div>
                    <div>
                        <h5 class="modal-title mb-0" id="patientRecordsModalLabel">
                            Patient Results
                        </h5>
                        <small class="opacity-90">View all medical records and test results</small>
                    </div>
                </div>
                <button type="button" class="btn-close btn-close-white" @click="closeModal('patient_records_modal')" aria-label="Close"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body p-0">
                <!-- Loading State -->
                <div v-if="loading_state.PREDICTION" class="text-center py-5">
                    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="text-muted mt-3">Loading patient records...</p>
                </div>

                <!-- Content -->
                <div v-else>
                    <!-- Records Found -->
                    <div v-if="lists.PREDICTION && lists.PREDICTION.count > 0">
                        <!-- Results Count Badge -->
                        <div class="px-4 pt-4 pb-3 bg-light border-bottom">
                            <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                                <div>
                                    <span class="badge bg-primary rounded-pill px-3 py-2">
                                        <i class="fa-solid fa-list-check me-2"></i>
                                        [[ lists.PREDICTION.count ]] Result(s) Found
                                    </span>
                                </div>
                                <div class="text-muted small">
                                    Showing [[ lists.PREDICTION.results.length ]] of [[ lists.PREDICTION.count ]]
                                </div>
                            </div>
                        </div>

                        <!-- Desktop Table View -->
                        <div class="table-responsive d-none d-lg-block">
                            <table class="table table-hover align-middle mb-0">
                                <thead class="bg-light sticky-top" style="top: 0;">
                                    <tr>
                                        <th scope="col" class="fw-semibold text-muted px-4 py-3">
                                            <i class="fa-solid fa-hashtag me-2"></i>Reference ID
                                        </th>
                                        <th scope="col" class="fw-semibold text-muted px-4 py-3">
                                            <i class="fa-solid fa-calendar-days me-2"></i>Date Added
                                        </th>
                                        <th scope="col" class="fw-semibold text-muted px-4 py-3">
                                            <i class="fa-solid fa-notes-medical me-2"></i>Remarks
                                        </th>
                                        <th scope="col" class="fw-semibold text-muted px-4 py-3 text-end">
                                            <i class="fa-solid fa-gear me-2"></i>Actions
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="prediction in lists.PREDICTION.results" :key="prediction.id" class="border-bottom">
                                        <td class="px-4 py-3">
                                            <div class="d-flex align-items-center">
                                                <div class="record-badge me-2">
                                                    <i class="fa-solid fa-file-lines"></i>
                                                </div>
                                                <span class="fw-medium text-primary">#[[ prediction.id ]]</span>
                                            </div>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="d-flex align-items-center text-muted">
                                                <i class="fa-solid fa-clock me-2"></i>
                                                <span>[[ new Date(prediction.created_at).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) ]]</span>
                                            </div>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="remarks-text">
                                                [[ prediction.remarks || 'No remarks provided' ]]
                                            </div>
                                        </td>
                                        <td class="px-4 py-3 text-end">
                                            <div class="btn-group" role="group">
                                                <button class="btn btn-sm btn-info text-white" @click="viewGraph(prediction)" title="View Graph">
                                                    <i class="fa-solid fa-chart-line me-1"></i>
                                                    View Graph
                                                </button>
                                                <button class="btn btn-sm btn-warning text-white" @click="downloadCSV(prediction)" title="Download CSV">
                                                    <i class="fa-solid fa-download me-1"></i>
                                                    Download CSV
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Mobile Card View -->
                        <div class="d-lg-none px-3 py-3">
                            <div v-for="prediction in lists.PREDICTION.results" :key="prediction.id" class="record-card mb-3">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-body p-3">
                                        <!-- Reference ID -->
                                        <div class="d-flex align-items-center mb-3">
                                            <div class="record-badge-mobile me-2">
                                                <i class="fa-solid fa-file-lines"></i>
                                            </div>
                                            <div>
                                                <small class="text-muted d-block" style="font-size: 0.75rem;">Reference ID</small>
                                                <span class="fw-bold text-primary">#[[ prediction.id ]]</span>
                                            </div>
                                        </div>

                                        <!-- Date Added -->
                                        <div class="mb-3">
                                            <small class="text-muted d-block mb-1" style="font-size: 0.75rem;">
                                                <i class="fa-solid fa-calendar-days me-1"></i>Date Added
                                            </small>
                                            <p class="mb-0 text-dark" style="font-size: 0.9rem;">
                                                <i class="fa-solid fa-clock me-1"></i>[[ new Date(prediction.created_at).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }) ]]
                                            </p>
                                        </div>

                                        <!-- Remarks -->
                                        <div class="mb-3">
                                            <small class="text-muted d-block mb-1" style="font-size: 0.75rem;">
                                                <i class="fa-solid fa-notes-medical me-1"></i>Remarks
                                            </small>
                                            <p class="mb-0 text-dark" style="font-size: 0.9rem;">
                                                [[ prediction.remarks || 'No remarks provided' ]]
                                            </p>
                                        </div>

                                        <!-- Actions -->
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-info btn-sm text-white" @click="viewGraph(prediction)">
                                                <i class="fa-solid fa-chart-line me-2"></i>View Graph
                                            </button>
                                            <button class="btn btn-warning btn-sm text-white" @click="downloadCSV(prediction)">
                                                <i class="fa-solid fa-download me-2"></i>Download CSV File
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Empty State -->
                    <div v-else class="text-center py-5 px-3">
                        <div class="empty-state">
                            <div class="empty-icon mb-3">
                                <i class="fa-solid fa-inbox"></i>
                            </div>
                            <h5 class="text-muted mb-2">No Records Found</h5>
                            <p class="text-muted small mb-0">
                                This patient doesn't have any medical records yet.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer bg-light border-0">
                <div class="w-100 d-flex justify-content-between align-items-center flex-wrap gap-2">
                    <!-- Pagination Controls -->
                    <div v-if="lists.PREDICTION && lists.PREDICTION.count > 0" class="d-flex gap-2">
                        <button class="btn btn-outline-primary btn-sm" 
                                :disabled="lists.PREDICTION.previous === null" 
                                @click="switchPage('PREVIOUS')"
                                title="Previous Page">
                            <i class="fa-solid fa-chevron-left me-1"></i>
                            <span class="d-none d-sm-inline">Previous</span>
                        </button>
                        <button class="btn btn-outline-primary btn-sm" 
                                :disabled="lists.PREDICTION.next === null" 
                                @click="switchPage('NEXT')"
                                title="Next Page">
                            <span class="d-none d-sm-inline">Next</span>
                            <i class="fa-solid fa-chevron-right ms-1"></i>
                        </button>
                    </div>
                    <div v-else></div>

                    <!-- Close Button -->
                    <button @click="closeModal('patient_records_modal')" 
                            type="button" 
                            class="btn btn-primary">
                        <i class="fa-solid fa-times me-2"></i>Close
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Modal Styling */
    .modal-content {
        border-radius: 1rem;
        overflow: hidden;
    }

    .modal-header.bg-gradient-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 1.5rem;
    }

    .modal-icon {
        width: 50px;
        height: 50px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }

    .modal-title {
        font-weight: 600;
        font-size: 1.25rem;
    }

    /* Record Badge */
    .record-badge {
        width: 36px;
        height: 36px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
    }

    .record-badge-mobile {
        width: 42px;
        height: 42px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
    }

    /* Table Styling */
    .table thead th {
        border-bottom: 2px solid #e2e8f0;
        font-size: 0.875rem;
    }

    .table tbody tr {
        transition: all 0.2s ease;
    }

    .table tbody tr:hover {
        background-color: #f8fafc;
        transform: translateX(2px);
    }

    .remarks-text {
        color: #4a5568;
        font-size: 0.9rem;
        line-height: 1.5;
        max-width: 400px;
    }

    /* Button Styling */
    .btn-info {
        background: linear-gradient(90deg, #06b6d4 0%, #0891b2 100%);
        border: none;
        transition: all 0.2s ease;
    }

    .btn-info:hover {
        background: linear-gradient(90deg, #0891b2 0%, #06b6d4 100%);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
    }

    .btn-warning {
        background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
        border: none;
        transition: all 0.2s ease;
    }

    .btn-warning:hover {
        background: linear-gradient(90deg, #d97706 0%, #f59e0b 100%);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
    }

    .btn-outline-primary {
        border-color: #667eea;
        color: #667eea;
        transition: all 0.2s ease;
    }

    .btn-outline-primary:hover:not(:disabled) {
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        border-color: #667eea;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .btn-outline-primary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .btn-primary {
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        border: none;
        transition: all 0.2s ease;
    }

    .btn-primary:hover {
        background: linear-gradient(90deg, #764ba2 0%, #667eea 100%);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    /* Card Styling for Mobile */
    .record-card .card {
        border-radius: 0.75rem;
        transition: all 0.3s ease;
    }

    .record-card .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1) !important;
    }

    /* Empty State */
    .empty-state .empty-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto;
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .empty-state .empty-icon i {
        font-size: 2.5rem;
        color: #cbd5e0;
    }

    /* Badge Styling */
    .badge {
        font-weight: 500;
        font-size: 0.875rem;
    }

    /* Loading Spinner */
    .spinner-border {
        border-width: 0.3rem;
    }

    /* Responsive Design */
    @media (max-width: 991.98px) {
        .modal-dialog {
            margin: 0.5rem;
        }

        .modal-header.bg-gradient-primary {
            padding: 1rem;
        }

        .modal-icon {
            width: 40px;
            height: 40px;
            font-size: 1.2rem;
        }

        .modal-title {
            font-size: 1.1rem;
        }

        .modal-header small {
            font-size: 0.75rem;
        }
    }

    @media (max-width: 575.98px) {
        .modal-dialog {
            margin: 0.25rem;
        }

        .modal-header.bg-gradient-primary {
            padding: 0.875rem;
        }

        .modal-icon {
            width: 36px;
            height: 36px;
            font-size: 1rem;
        }

        .modal-title {
            font-size: 1rem;
        }

        .modal-header small {
            font-size: 0.7rem;
        }

        .modal-body {
            max-height: 60vh;
        }

        .modal-footer {
            padding: 0.75rem;
        }

        .btn-sm {
            font-size: 0.8rem;
            padding: 0.375rem 0.75rem;
        }

        .record-card .card-body {
            padding: 0.875rem !important;
        }

        .badge {
            font-size: 0.75rem;
            padding: 0.375rem 0.75rem !important;
        }
    }

    /* Scrollbar Styling */
    .modal-body::-webkit-scrollbar {
        width: 8px;
    }

    .modal-body::-webkit-scrollbar-track {
        background: #f1f1f1;
    }

    .modal-body::-webkit-scrollbar-thumb {
        background: #667eea;
        border-radius: 4px;
    }

    .modal-body::-webkit-scrollbar-thumb:hover {
        background: #764ba2;
    }

    /* Smooth Animations */
    .modal.fade .modal-dialog {
        transition: transform 0.3s ease-out;
    }

    .modal.show .modal-dialog {
        transform: none;
    }
</style>