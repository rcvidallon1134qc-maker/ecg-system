<!-- Graph Modal - Responsive & Modern Design -->
<div class="modal fade" id="graph_modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" style="z-index: 2000;">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content" style="border-radius: 1.2rem; border: none; box-shadow: 0 1rem 3rem rgba(0,0,0,0.175);">
            <!-- Modal Header -->
            <div class="modal-header border-0 pb-0" style="padding: 1.5rem 1.5rem 1rem;">
                <div>
                    <h5 class="modal-title fw-bold" style="color: #2d3748; font-size: 1.25rem;">
                        <i class="fa-solid fa-heart-pulse me-2" style="color: #667eea;"></i>[[ info.TITLE ]]
                    </h5>
                    <p class="text-muted small mb-0" style="margin-top: 0.25rem;">
                        <i class="fa-solid fa-info-circle me-1"></i>Review patient ECG data and add notes or prescriptions
                    </p>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body" style="padding: 1.5rem;">
                <!-- ECG Graph Section -->
                <div class="graph-section mb-4">
                    <div class="card border-0 dashboard-card" style="background: #f8fafc; padding: 1.5rem;">
                        <div class="d-flex align-items-center mb-3">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; margin-right: 1rem;">
                                <i class="fa-solid fa-chart-line"></i>
                            </div>
                            <div>
                                <h6 class="mb-0" style="color: #2d3748; font-weight: 600;">ECG Recording</h6>
                                <small class="text-muted">Patient electrocardiogram</small>
                            </div>
                        </div>
                        <div id="ecg-graph" style="min-height: 300px; display: flex; align-items: center; justify-content: center;">
                            <!-- Graph will render here -->
                        </div>
                    </div>
                </div>

                <!-- ECG Prediction Results -->
                <div class="prediction-results mb-4">
                    <div class="card border-0 dashboard-card" style="padding: 1.5rem;">
                        <div class="d-flex align-items-center mb-3">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(90deg, #43cea2 0%, #185a9d 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; margin-right: 1rem;">
                                <i class="fa-solid fa-stethoscope"></i>
                            </div>
                            <div>
                                <h6 class="mb-0" style="color: #2d3748; font-weight: 600;">ECG Prediction Results</h6>
                                <small class="text-muted">Analysis from patient record</small>
                            </div>
                        </div>

                        <div class="row g-3">
                            <!-- ECG Result Card -->
                            <div class="col-12 col-md-6">
                                <div class="result-card p-3" :class="state.PREDICTION_RESULT.is_normal ? 'result-normal' : 'result-arrhythmia'">
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="result-icon me-3">
                                            <i :class="state.PREDICTION_RESULT.is_normal ? 'fa-solid fa-heart-pulse' : 'fa-solid fa-heart-crack'"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-1 fw-bold" style="color: #2d3748;">ECG Result</h6>
                                            <p class="mb-0 fw-semibold" :style="{'color': state.PREDICTION_RESULT.is_normal ? '#10b981' : '#ef4444'}">
                                                [[ state.PREDICTION_RESULT.result ]]
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Heart Condition Card -->
                            <div class="col-12 col-md-6">
                                <div class="result-card p-3" :class="state.PREDICTION_RESULT.is_strong ? 'result-strong' : 'result-weak'">
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="result-icon me-3">
                                            <i :class="state.PREDICTION_RESULT.is_strong ? 'fa-solid fa-shield-heart' : 'fa-solid fa-heart'"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-1 fw-bold" style="color: #2d3748;">Heart Condition</h6>
                                            <p class="mb-0 fw-semibold" :style="{'color': state.PREDICTION_RESULT.is_strong ? '#3b82f6' : '#f59e0b'}">
                                                [[ state.PREDICTION_RESULT.condition ]]
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notes/Prescription Section -->
                <div class="notes-section">
                    <div class="mb-3">
                        <label class="form-label fw-semibold" style="color: #2d3748; font-size: 0.95rem;">
                            <i class="fa-solid fa-clipboard me-2" style="color: #667eea;"></i>Add Notes or Prescription
                            <span class="badge bg-light text-dark ms-2">Optional</span>
                        </label>
                        <textarea 
                            class="form-control" 
                            rows="4"
                            v-model="state.NOTES" 
                            placeholder="Enter clinical notes, observations, or prescriptions here..."
                            style="border-radius: 0.7rem; border: 1px solid #e2e8f0; font-size: 0.95rem;">
                        </textarea>
                        <small class="text-muted d-block mt-2">
                            <i class="fa-solid fa-lightbulb me-1"></i>Tip: Include medication details, dosage, and duration
                        </small>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer border-0 pt-0" style="padding: 0 1.5rem 1.5rem; gap: 0.75rem;">
                <button 
                    type="button" 
                    class="btn btn-outline-primary dashboard-btn" 
                    @click="closeModal('graph_modal')"
                    style="border-radius: 0.7rem;">
                    <i class="fa-solid fa-times me-2"></i>Close
                </button>
                <button 
                    type="button"
                    class="btn btn-outline-warning dashboard-btn" 
                    @click="viewPrescription()"
                    style="border-radius: 0.7rem; border-color: #f59e0b; color: #f59e0b;">
                    <i class="fa-solid fa-eye me-2"></i>View Prescription
                </button>
                <button 
                    type="button"
                    class="btn btn-primary dashboard-btn" 
                    @click="updatePrescription()"
                    style="border-radius: 0.7rem; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); border: none;">
                    <i class="fa-solid fa-check me-2"></i>Save Notes
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    /* Modal Enhancements */
    .modal-dialog {
        --bs-modal-width: auto;
        max-width: 90vw;
    }

    @media (min-width: 992px) {
        .modal-dialog.modal-lg {
            --bs-modal-width: 800px;
        }
    }

    @media (max-width: 991.98px) {
        .modal-dialog.modal-lg {
            --bs-modal-width: 95vw;
            max-width: 95vw;
        }

        .modal-body {
            padding: 1.25rem !important;
        }

        .modal-header {
            padding: 1.25rem 1.25rem 0.75rem !important;
        }

        .modal-footer {
            padding: 0 1.25rem 1.25rem !important;
            flex-wrap: wrap;
        }

        .modal-footer .btn {
            flex: 1 1 calc(50% - 0.375rem);
            min-width: 120px;
            font-size: 0.875rem;
            padding: 0.5rem 0.75rem;
        }

        .modal-footer .btn:nth-child(3) {
            flex: 1 1 100%;
        }
    }

    @media (max-width: 767.98px) {
        .modal-dialog.modal-lg {
            --bs-modal-width: 100%;
            max-width: calc(100vw - 1rem);
            margin: 0.5rem auto;
        }

        .modal-content {
            border-radius: 1rem !important;
        }

        .modal-body {
            padding: 1rem !important;
        }

        .modal-header {
            padding: 1rem 1rem 0.5rem !important;
            flex-direction: column;
            align-items: flex-start;
        }

        .modal-header .btn-close {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
        }

        .modal-title {
            font-size: 1.125rem !important;
        }

        #ecg-graph {
            min-height: 250px !important;
        }

        .modal-footer {
            padding: 0 1rem 1rem !important;
            gap: 0.5rem !important;
        }

        .modal-footer .btn {
            flex: 1 1 100%;
            font-size: 0.813rem;
            padding: 0.5rem 0.75rem;
        }

        textarea.form-control {
            font-size: 1rem !important;
            padding: 0.75rem !important;
        }
    }

    @media (max-width: 575.98px) {
        .modal-dialog.modal-lg {
            --bs-modal-width: 100%;
            max-width: calc(100vw - 0.5rem);
            margin: 0.25rem auto;
        }

        .modal-content {
            border-radius: 0.875rem !important;
        }

        .modal-header {
            padding: 0.875rem !important;
        }

        .modal-body {
            padding: 0.875rem !important;
        }

        .modal-footer {
            padding: 0 0.875rem 0.875rem !important;
            gap: 0.375rem !important;
        }

        .modal-title {
            font-size: 1rem !important;
        }

        .modal-title i {
            font-size: 0.875rem;
        }

        #ecg-graph {
            min-height: 200px !important;
        }

        .graph-section .card {
            padding: 1rem !important;
        }

        textarea.form-control {
            rows: 3;
            font-size: 16px !important;
            padding: 0.625rem !important;
        }

        .form-label {
            font-size: 0.875rem !important;
        }

        .modal-footer .btn {
            padding: 0.5rem 0.625rem !important;
            font-size: 0.75rem !important;
        }

        .modal-footer .btn i {
            font-size: 0.75rem;
            margin-right: 0.25rem !important;
        }

        .modal-footer .btn span {
            display: none;
        }

        .modal-footer .btn::before {
            content: attr(data-label);
        }
    }

    /* Dashboard Card Styles (if not already defined) */
    .dashboard-card {
        border-radius: 1.2rem;
        background: #fff;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.10);
        transition: transform 0.3s, box-shadow 0.3s;
    }

    .dashboard-btn {
        border-radius: 0.7rem;
        font-weight: 500;
        transition: all 0.2s ease;
        padding: 0.5rem 1rem;
    }

    .btn-outline-primary {
        border-color: #667eea;
        color: #667eea;
    }

    .btn-outline-primary:hover {
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%) !important;
        border-color: #667eea !important;
        color: #fff !important;
        box-shadow: 0 0.5rem 1rem rgba(102,126,234,0.15);
        transform: translateY(-2px);
    }

    .btn-primary {
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: #fff;
    }

    .btn-primary:hover {
        background: linear-gradient(90deg, #764ba2 0%, #667eea 100%) !important;
        box-shadow: 0 0.5rem 1rem rgba(102,126,234,0.15);
        transform: translateY(-2px);
    }

    .form-control {
        border-radius: 0.7rem;
        border: 1px solid #e2e8f0;
        font-size: 0.95rem;
    }

    .form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.15rem rgba(102,126,234,0.15);
    }

    .form-label {
        color: #2d3748;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .badge {
        padding: 0.35rem 0.75rem;
        font-weight: 600;
        font-size: 0.75rem;
        border-radius: 0.7rem;
    }

    /* Prediction Result Styles */
    .result-card {
        border-radius: 0.875rem;
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }

    .result-normal {
        background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        border-color: #10b981;
    }

    .result-arrhythmia {
        background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        border-color: #ef4444;
    }

    .result-strong {
        background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        border-color: #3b82f6;
    }

    .result-weak {
        background: linear-gradient(135deg, #fed7aa 0%, #fdba74 100%);
        border-color: #f59e0b;
    }

    .result-icon {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        background: rgba(255, 255, 255, 0.9);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        flex-shrink: 0;
    }

    .result-normal .result-icon {
        color: #10b981;
    }

    .result-arrhythmia .result-icon {
        color: #ef4444;
    }

    .result-strong .result-icon {
        color: #3b82f6;
    }

    .result-weak .result-icon {
        color: #f59e0b;
    }

    .result-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
</style>